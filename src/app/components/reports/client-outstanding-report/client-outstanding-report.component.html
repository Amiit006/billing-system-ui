<div class="container">
    <h1>
        <img src="/assets/bar-chart.svg" class="pnl-head-icon" alt="Chart">
        Client Outstanding Report
    </h1>
    <hr class="header-hr" />

    <!-- Loading state -->
    <div *ngIf="reportStatus === 'loading'" class="section text-center">
        <div class="state-process-container">
            <div class="state-process">
                <img class="state-process-img" src="/assets/jobber.svg" alt="">
                <h3 class="state-process-h3" id="mainText">Building report</h3>
                <p class="throbber-loader"></p>
            </div>
        </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="dataSource.data?.length === 0 && reportStatus === 'loaded'">
        <app-no-result [h3TextInput]="'Result empty'" [pTextInput]="'There is no sell record in this period'">
        </app-no-result>
    </div>

    <!-- Content -->
    <div [hidden]="!(dataSource.data?.length > 0)">
        <!-- Charts + CSV action -->
        <div class="charts-and-actions">
            <div class="chart-container" #chartContainer>
                <ngx-charts-number-card [view]="view" [scheme]="colorScheme" [results]="single" [cardColor]="cardColor">
                </ngx-charts-number-card>
            </div>


        </div>
        <div class="row ml-2">
            <div class="actions">
                <button mat-stroked-button (click)="downloadFile(dataSource.data)">
                    <mat-icon>cloud_download</mat-icon>
                    CSV
                </button>
            </div>
        </div>
        <!-- Mobile list (Client | Outstanding), Desktop table otherwise -->
        <ng-container *ngIf="isHandset; else desktopTable">
            <div class="mobile-grid" role="table" aria-label="Client outstanding list">

                <!-- Sticky header with tappable sort -->
                <div class="grid-header" role="row">
                    <button class="hdr btn" role="columnheader" (click)="sortMobileBy('clientName')"
                        [attr.aria-sort]="mobileSort.active==='clientName' ? mobileSort.direction : 'none'">
                        Client
                        <mat-icon class="sort-icn" *ngIf="mobileSort.active==='clientName'">
                            {{ mobileSort.direction==='asc' ? 'arrow_upward' : 'arrow_downward' }}
                        </mat-icon>
                    </button>

                    <button class="hdr btn right" role="columnheader" (click)="sortMobileBy('outstandingAmount')"
                        [attr.aria-sort]="mobileSort.active==='outstandingAmount' ? mobileSort.direction : 'none'">
                        Outstanding
                        <mat-icon class="sort-icn" *ngIf="mobileSort.active==='outstandingAmount'">
                            {{ mobileSort.direction==='asc' ? 'arrow_upward' : 'arrow_downward' }}
                        </mat-icon>
                    </button>
                </div>

                <!-- Rows -->
                <div class="grid-row" role="row" *ngFor="let row of dataSource.data">
                    <div class="cell name" role="cell" title="{{row.clientName}}">
                        {{ row.clientName }}
                    </div>
                    <div class="cell amt" role="cell">
                        {{ row.outstandingAmount | number }}
                    </div>
                </div>

            </div>
        </ng-container>


        <ng-template #desktopTable>
            <div class="table-wrapper">
                <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 full-width">
                    <ng-container *ngFor="let disCol of displayedColumns; let i = index" [matColumnDef]="disCol">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>
                            {{ displayedColumnsValue[i] }}
                        </th>
                        <td mat-cell *matCellDef="let element">
                            {{ element[disCol] }}
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                </table>
            </div>

            <mat-paginator [pageSizeOptions]="[10, 20]" [pageSize]="pageSize" showFirstLastButtons>
            </mat-paginator>
        </ng-template>
    </div>
</div>